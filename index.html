<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema de Gesti√≥n de Socios - Valle Real</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 4px solid #dc2626;
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      margin: -40px -40px 40px -40px;
      padding: 40px;
      border-radius: 20px 20px 0 0;
    }
    .header h1 {
      color: white;
      font-size: 3em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-weight: 800;
      letter-spacing: 2px;
    }
    .header p {
      color: rgba(255,255,255,0.95);
      font-size: 1.3em;
      font-weight: 500;
    }
    .icon-large {
      font-size: 4em;
      color: white;
      margin-bottom: 20px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    }
    .card {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 2px solid #e9ecef;
      transition: all 0.3s;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .card h3 {
      color: #dc2626;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5em;
      font-weight: 700;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    .form-group {
      margin-bottom: 0;
      position: relative;
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95em;
    }
    label i {
      color: #dc2626;
      width: 20px;
    }
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    input:disabled {
      background: #e9ecef;
      cursor: not-allowed;
      color: #666;
    }
    .btn-clear {
      position: absolute;
      right: 12px;
      top: 38px;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s;
    }
    .btn-clear:hover {
      background: #991b1b;
      transform: scale(1.1);
    }
    .form-group.modified input {
      border-color: #f59e0b;
      background: #fef3c7;
    }
    .form-group.cleared input {
      border-color: #ef4444;
      background: #fee2e2;
    }
    .change-indicator {
      font-size: 12px;
      font-weight: 600;
      margin-top: 4px;
      display: none;
    }
    .change-indicator.modified {
      color: #f59e0b;
      display: block;
    }
    .change-indicator.cleared {
      color: #ef4444;
      display: block;
    }
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }
    .btn-danger {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
    }
    .btn-info {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
      color: white;
    }
    .btn-modify {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      color: white;
    }
    .alert {
      padding: 18px 24px;
      border-radius: 12px;
      margin-bottom: 25px;
      display: none;
      animation: slideIn 0.3s;
      font-weight: 500;
      font-size: 1.05em;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .alert.success {
      background: #d4edda;
      color: #155724;
      border-left: 5px solid #28a745;
    }
    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 5px solid #dc3545;
    }
    .alert.info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 5px solid #17a2b8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    th {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
      padding: 16px;
      text-align: left;
      font-weight: 700;
      font-size: 0.95em;
    }
    td {
      padding: 14px 16px;
      border-bottom: 1px solid #e9ecef;
      font-size: 0.9em;
    }
    tr:hover {
      background: #f8f9fa;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
      transition: all 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(220, 38, 38, 0.4);
    }
    .stat-card i {
      font-size: 3em;
      margin-bottom: 15px;
      opacity: 0.9;
    }
    .stat-card h4 {
      font-size: 2.5em;
      margin: 10px 0;
      font-weight: 800;
    }
    .stat-card p {
      opacity: 0.95;
      font-size: 1.1em;
      font-weight: 500;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 25px;
    }
    .fingerprint-scanner {
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      border-radius: 15px;
      color: white;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(220, 38, 38, 0.3);
    }
    .fingerprint-icon {
      font-size: 6em;
      animation: pulse 2s infinite;
      filter: drop-shadow(0 0 20px rgba(255,255,255,0.5));
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.08); }
    }
    .loading {
      display: none;
      text-align: center;
      padding: 25px;
    }
    .loading.active {
      display: block;
    }
    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #dc2626;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .chart-container {
      background: white;
      padding: 25px;
      border-radius: 15px;
      margin-top: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .hidden {
      display: none !important;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      animation: fadeIn 0.3s;
    }
    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      animation: slideUp 0.3s;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
    }
    .modal-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      transition: all 0.2s;
    }
    .modal-close-btn:hover {
      color: #dc2626;
      transform: scale(1.2);
    }
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-content h2 {
      color: #dc2626;
      margin-bottom: 20px;
      font-size: 2.2em;
      font-weight: 800;
    }
    .modal-content i {
      font-size: 5em;
      margin-bottom: 20px;
    }
    .modal-content.warning i {
      color: #f59e0b;
    }
    .modal-content.success i {
      color: #28a745;
    }
    .modal-content p {
      font-size: 1.2em;
      line-height: 1.8;
      color: #333;
      margin-bottom: 15px;
    }
    .modal-content .rules {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 12px;
      margin: 25px 0;
      border-left: 5px solid #dc2626;
      text-align: left;
    }
    .modal-content .rules h3 {
      color: #dc2626;
      margin-bottom: 15px;
      font-size: 1.3em;
      font-weight: 700;
    }
    .modal-content .rules ul {
      list-style: none;
      padding-left: 0;
    }
    .modal-content .rules li {
      padding: 10px 0;
      padding-left: 30px;
      position: relative;
      font-size: 1.05em;
      line-height: 1.6;
    }
    .modal-content .rules li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #28a745;
      font-weight: bold;
      font-size: 1.3em;
    }
    #modalBienvenida .modal-content {
      max-width: 450px;
      padding: 30px;
    }
    #modalBienvenida .modal-close-btn {
      top: 15px;
      right: 15px;
      font-size: 24px;
    }
    #modalBienvenida [style*="max-height: 200px"] {
      scrollbar-width: thin;
      scrollbar-color: #dc2626 #f0f0f0;
    }
    #modalBienvenida [style*="max-height: 200px"]::-webkit-scrollbar {
      width: 6px;
    }
    #modalBienvenida [style*="max-height: 200px"]::-webkit-scrollbar-track {
      background: #f0f0f0;
      border-radius: 10px;
    }
    #modalBienvenida [style*="max-height: 200px"]::-webkit-scrollbar-thumb {
      background: #dc2626;
      border-radius: 10px;
    }
    .search-filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .mode-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 700;
      margin-bottom: 15px;
      margin-right: 10px;
    }
    .mode-badge.read {
      background: #d1ecf1;
      color: #0c5460;
    }
    .mode-badge.edit {
      background: #fff3cd;
      color: #856404;
    }
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      .header {
        margin: -20px -20px 30px -20px;
        padding: 30px 20px;
      }
      .header h1 {
        font-size: 2em;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .btn {
        width: 100%;
        justify-content: center;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .search-filters {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <i class="fas fa-home icon-large"></i>
      <h1>VALLE REAL</h1>
      <p>Sistema de Gesti√≥n de Socios</p>
    </div>

    <div id="alert" class="alert"></div>
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="font-size: 1.2em; font-weight: 600; color: #dc2626;">Procesando...</p>
    </div>

    <!-- Secci√≥n Consulta -->
    <div class="card" id="consultaSection">
      <div class="fingerprint-scanner">
        <i class="fas fa-fingerprint fingerprint-icon"></i>
        <h2 style="margin-top: 20px; font-size: 1.8em;">Verificaci√≥n de Identidad</h2>
        <p style="margin-top: 10px; font-size: 1.1em; opacity: 0.95;">Ingrese su DNI para consultar o registrar sus datos</p>
      </div>
      
      <form id="formConsulta">
        <div class="form-group">
          <label><i class="fas fa-id-card"></i> DNI (8 d√≠gitos):</label>
          <input type="text" id="dni" maxlength="8" pattern="\d{8}" placeholder="Ejemplo: 12345678" required />
        </div>
        <div class="btn-group">
          <button type="submit" class="btn btn-danger">
            <i class="fas fa-search"></i> Consultar
          </button>
        </div>
      </form>
    </div>
    <!-- Formulario de Datos -->
    <div id="formDatos" class="hidden">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3 style="margin-bottom: 0;"><i class="fas fa-user-edit"></i> <span id="formTitle">Datos del Socio</span></h3>
          <span id="modeBadge" class="mode-badge read">Modo Lectura</span>
        </div>
        
        <form id="formEdicion">
          <div class="form-grid">
            <div class="form-group">
              <label><i class="fas fa-id-card"></i> DNI:</label>
              <input type="text" id="dniEdit" disabled />
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-user"></i> Apellido Paterno:</label>
              <input type="text" id="apellidoPaterno" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-user"></i> Apellido Materno:</label>
              <input type="text" id="apellidoMaterno" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-user-circle"></i> Nombres:</label>
              <input type="text" id="nombres" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-phone"></i> Tel√©fono 1:</label>
              <input type="text" id="telefono1" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-mobile-alt"></i> Tel√©fono 2:</label>
              <input type="text" id="telefono2" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group full-width">
              <label><i class="fas fa-map-marker-alt"></i> Direcci√≥n:</label>
              <input type="text" id="direccion" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-ring"></i> C√≥nyuge:</label>
              <input type="text" id="conyuge" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-layer-group"></i> Etapa:</label>
              <input type="text" id="etapa" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group full-width">
              <label><i class="fas fa-envelope"></i> Email:</label>
              <input type="email" id="email" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-money-bill-wave"></i> Pago de Cuota:</label>
              <select id="pagoCuota" disabled>
                <option value="">Seleccione</option>
                <option value="S√≠">S√≠ - Al d√≠a</option>
                <option value="No">No - Pendiente</option>
              </select>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-star"></i> Puntuaci√≥n:</label>
              <input type="number" id="puntuacion" min="0" max="100" disabled />
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-car"></i> Placa Veh√≠culo 1:</label>
              <input type="text" id="placa1" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-car-side"></i> Placa Veh√≠culo 2:</label>
              <input type="text" id="placa2" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
            
            <div class="form-group">
              <label><i class="fas fa-truck"></i> Placa Veh√≠culo 3:</label>
              <input type="text" id="placa3" disabled />
              <button type="button" class="btn-clear" title="Limpiar">‚úï</button>
              <div class="change-indicator"></div>
            </div>
          </div>
          
          <div class="btn-group" id="btnGroupView">
            <button type="button" class="btn btn-modify" id="btnModificar" style="display: none;">
              <i class="fas fa-edit"></i> Modificar Datos
            </button>
            <button type="button" class="btn btn-warning" id="btnDescargarPDF">
              <i class="fas fa-file-pdf"></i> Descargar Reporte
            </button>
            <button type="button" class="btn btn-secondary" id="btnCancelar">
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>

          <div class="btn-group" id="btnGroupEdit" style="display: none;">
            <button type="submit" class="btn btn-success" id="btnGuardar">
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <button type="button" class="btn btn-secondary" id="btnCancelarEdicion">
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Login Administrador -->
    <div class="card" id="loginAdmin">
      <h3><i class="fas fa-user-shield"></i> Acceso Administrador</h3>
      <form id="formLoginAdmin">
        <div class="form-grid">
          <div class="form-group">
            <label><i class="fas fa-id-badge"></i> DNI Administrador:</label>
            <input type="text" id="adminDni" maxlength="8" pattern="\d{8}" placeholder="DNI del administrador" required />
          </div>
          <div class="form-group">
            <label><i class="fas fa-key"></i> Contrase√±a:</label>
            <input type="password" id="adminPass" placeholder="Contrase√±a" required />
          </div>
        </div>
        <div class="btn-group">
          <button type="submit" class="btn btn-danger">
            <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
          </button>
        </div>
      </form>
    </div>

    <!-- Panel Administrador -->
    <div id="panelAdmin" class="hidden">
      <div class="card">
        <h3><i class="fas fa-chart-line"></i> Dashboard de Estad√≠sticas</h3>
        
        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-users"></i>
            <h4 id="totalSocios">0</h4>
            <p>Total Socios</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-phone"></i>
            <h4 id="conDatos">0</h4>
            <p>Con Tel√©fono</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-phone-slash"></i>
            <h4 id="sinDatos">0</h4>
            <p>Sin Tel√©fono</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-heart"></i>
            <h4 id="conConyuge">0</h4>
            <p>Con C√≥nyuge</p>
          </div>
        </div>

        <div class="chart-container">
          <canvas id="chartSocios"></canvas>
        </div>
      </div>

      <div class="card">
        <h3><i class="fas fa-search-plus"></i> B√∫squeda Avanzada de Socios</h3>
        <form id="formBusquedaAvanzada">
          <div class="search-filters">
            <div class="form-group">
              <label><i class="fas fa-id-card"></i> DNI:</label>
              <input type="text" id="busqDni" placeholder="Buscar por DNI" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-user"></i> Nombre:</label>
              <input type="text" id="busqNombre" placeholder="Buscar por nombre" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-phone"></i> Tel√©fono:</label>
              <input type="text" id="busqTel" placeholder="Buscar por tel√©fono" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-map-marker-alt"></i> Direcci√≥n:</label>
              <input type="text" id="busqDir" placeholder="Buscar por direcci√≥n" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-layer-group"></i> Etapa:</label>
              <input type="text" id="busqEtapa" placeholder="Buscar por etapa" />
            </div>
            <div class="form-group">
              <label><i class="fas fa-envelope"></i> Email:</label>
              <input type="text" id="busqEmail" placeholder="Buscar por email" />
            </div>
          </div>
          <div class="btn-group">
            <button type="submit" class="btn btn-danger">
              <i class="fas fa-search"></i> Buscar
            </button>
            <button type="button" class="btn btn-info" id="btnMostrarTodos">
              <i class="fas fa-list"></i> Mostrar Todos
            </button>
          </div>
        </form>
        
        <div id="resultadosBusqueda"></div>
      </div>

      <div class="card">
        <h3><i class="fas fa-download"></i> Exportar Reportes</h3>
        <div class="btn-group">
          <button class="btn btn-danger" id="btnReportePDF">
            <i class="fas fa-file-pdf"></i> Exportar PDF
          </button>
          <button class="btn btn-success" id="btnReporteExcel">
            <i class="fas fa-file-excel"></i> Exportar Excel
          </button>
          <button class="btn btn-warning" id="btnDescargarGrafico">
            <i class="fas fa-chart-bar"></i> Descargar Gr√°fico
          </button>
          <button class="btn btn-secondary" id="btnCerrarSesion">
            <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Advertencia Modificaci√≥n -->
  <div id="modalAdvertencia" class="modal">
    <div class="modal-content warning">
      <button class="modal-close-btn" id="btnCerrarAdvertencia">‚úï</button>
      <i class="fas fa-exclamation-triangle"></i>
      <h2>¬°Importante!</h2>
      <p style="font-size: 1.3em; font-weight: 600; color: #f59e0b;">Modo Edici√≥n Activado</p>
      
      <div class="rules">
        <h3><i class="fas fa-shield-alt"></i> Cuidados al Modificar sus Datos</h3>
        <ul>
          <li>Verifique que todos los datos sean correctos antes de guardar</li>
          <li>No ingrese informaci√≥n falsa o datos de terceros</li>
          <li>Si desea borrar un campo, use el bot√≥n X al lado del campo</li>
          <li>Los cambios realizados ser√°n registrados en el sistema</li>
          <li>Aseg√∫rese de actualizar su tel√©fono si ha cambiado</li>
          <li>Revise cuidadosamente las placas de sus veh√≠culos</li>
          <li>Guarde solo cuando est√© completamente seguro de los cambios</li>
        </ul>
      </div>
      
      <p style="margin-top: 20px; font-weight: 600; color: #666;">¬øDesea continuar con la edici√≥n?</p>
      
      <div class="btn-group" style="margin-top: 20px;">
        <button class="btn btn-success" id="btnConfirmarModificacion">
          <i class="fas fa-check"></i> S√≠, Continuar
        </button>
        <button class="btn btn-secondary" id="btnCancelarModificacion">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Bienvenida (VERSI√ìN LIMPIA) -->
  <div id="modalBienvenida" class="modal">
    <div class="modal-content success" style="max-width: 450px; padding: 30px;">
      <button class="modal-close-btn" id="btnCerrarBienvenida">‚úï</button>
      
      <i class="fas fa-check-circle" style="font-size: 4em; color: #28a745; margin-bottom: 15px;"></i>
      
      <h2 style="color: #dc2626; font-size: 2em; margin-bottom: 15px;">¬°Bienvenido!</h2>
      
      <p style="font-size: 1.1em; color: #28a745; font-weight: 600; margin-bottom: 10px;">
        ‚úÖ Registro exitoso
      </p>
      
      <p style="font-size: 0.95em; color: #666; margin-bottom: 20px; line-height: 1.6;">
        Sus datos han sido registrados correctamente en nuestro sistema.
      </p>
      
      <!-- Acuerdos en formato compacto -->
      <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; border-left: 4px solid #dc2626; max-height: 200px; overflow-y: auto;">
        <h3 style="color: #dc2626; font-size: 0.95em; margin-bottom: 10px;">
          <i class="fas fa-clipboard-list"></i> Acuerdos de la Urbanizaci√≥n
        </h3>
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Mantener cuotas al d√≠a
          </li>
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Respetar √°reas comunes
          </li>
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Cumplir horarios establecidos
          </li>
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Mantener limpieza en propiedad
          </li>
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Respetar convivencia con vecinos
          </li>
          <li style="padding: 6px 0; font-size: 0.85em; color: #444; padding-left: 25px; position: relative;">
            <span style="position: absolute; left: 0; color: #28a745; font-weight: bold;">‚úì</span>
            Comunicar cambios de datos
          </li>
        </ul>
      </div>
      
      <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
        ‚ú® Gracias por ser parte de nuestra comunidad
      </p>
      
      <!-- Botones -->
      <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
        <button class="btn btn-success" id="btnCerrarModalBienvenida" style="margin: 5px; flex: 1; min-width: 150px;">
          <i class="fas fa-check"></i> Entendido
        </button>
        <button class="btn btn-secondary" id="btnNuevaConsulta" style="margin: 5px; flex: 1; min-width: 150px;">
          <i class="fas fa-search"></i> Nueva Consulta
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Actualizaci√≥n -->
  <div id="modalActualizacion" class="modal">
    <div class="modal-content success">
      <button class="modal-close-btn" id="btnCerrarActualizacion">‚úï</button>
      <i class="fas fa-check-circle"></i>
      <h2>¬°Datos Actualizados!</h2>
      <p style="font-size: 1.3em; font-weight: 600; color: #28a745;">Actualizaci√≥n exitosa</p>
      <p>Sus datos han sido actualizados correctamente en nuestro sistema.</p>
      <p style="margin-top: 20px;">Recuerde mantener su informaci√≥n siempre actualizada.</p>
      
      <button class="btn btn-success" id="btnCerrarModalActualizar" style="margin-top: 20px;">
        <i class="fas fa-check"></i> Aceptar
      </button>
    </div>
  </div>
  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxk5i94kV-2IKaXC1pntjHmfqk22Y9Y0KGr0f9zg8fN8IKIEGmYCUd9fBZ2KOOGzVyPJg/exec';

    const alertBox = document.getElementById('alert');
    const loading = document.getElementById('loading');
    const formConsulta = document.getElementById('formConsulta');
    const formDatos = document.getElementById('formDatos');
    const formEdicion = document.getElementById('formEdicion');
    const consultaSection = document.getElementById('consultaSection');
    const modalBienvenida = document.getElementById('modalBienvenida');
    const modalActualizacion = document.getElementById('modalActualizacion');
    const modalAdvertencia = document.getElementById('modalAdvertencia');

    let todosSocios = [];
    let chartInstance = null;
    let socioActual = null;
    let datosOriginales = {};
    let esNuevoSocio = false;
    let enModoEdicion = false;

    function showAlert(message, type = 'success') {
      alertBox.innerHTML = '<i class="fas fa-' + (type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle') + '"></i> ' + message;
      alertBox.className = 'alert ' + type;
      alertBox.style.display = 'block';
      setTimeout(() => { alertBox.style.display = 'none'; }, 5000);
    }

    function showLoading(show) {
      loading.className = show ? 'loading active' : 'loading';
    }

    function resetToSearch() {
      formDatos.classList.add('hidden');
      consultaSection.classList.remove('hidden');
      formConsulta.reset();
      clearForm();
      socioActual = null;
      datosOriginales = {};
      esNuevoSocio = false;
      enModoEdicion = false;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Consultar Socio
    formConsulta.addEventListener('submit', async (e) => {
      e.preventDefault();
      const dni = document.getElementById('dni').value.trim();
      
      if (!/^\d{8}$/.test(dni)) {
        showAlert('El DNI debe tener exactamente 8 d√≠gitos', 'error');
        return;
      }
      
      showLoading(true);
      
      try {
        const resp = await fetch(`${APPS_SCRIPT_URL}?action=consultar&dni=${dni}`);
        const data = await resp.json();
        
        if (data.success) {
          socioActual = data.socio;
          datosOriginales = JSON.parse(JSON.stringify(data.socio));
          esNuevoSocio = false;
          enModoEdicion = false;
          fillForm(data.socio);
          document.getElementById('formTitle').textContent = 'Datos del Socio';
          document.getElementById('btnModificar').style.display = 'inline-flex';
          document.getElementById('btnGroupView').style.display = 'flex';
          document.getElementById('btnGroupEdit').style.display = 'none';
          setFormDisabled(true);
          document.getElementById('modeBadge').textContent = 'Modo Lectura';
          document.getElementById('modeBadge').className = 'mode-badge read';
          showAlert('Socio encontrado en el sistema', 'success');
          formDatos.classList.remove('hidden');
          consultaSection.classList.add('hidden');
        } else {
          socioActual = { dni };
          datosOriginales = { dni };
          esNuevoSocio = true;
          enModoEdicion = true;
          clearForm();
          document.getElementById('dniEdit').value = dni;
          document.getElementById('formTitle').textContent = 'Registrar Nuevo Socio';
          document.getElementById('btnModificar').style.display = 'none';
          document.getElementById('btnGroupView').style.display = 'none';
          document.getElementById('btnGroupEdit').style.display = 'flex';
          setFormDisabled(false);
          document.getElementById('modeBadge').textContent = 'Modo Registro';
          document.getElementById('modeBadge').className = 'mode-badge edit';
          showAlert('DNI no encontrado. Complete el formulario para registrarse', 'info');
          formDatos.classList.remove('hidden');
          consultaSection.classList.add('hidden');
        }
      } catch (error) {
        showAlert('Error al consultar: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    });

    document.getElementById('btnModificar').addEventListener('click', () => {
      modalAdvertencia.classList.add('active');
    });

    document.getElementById('btnConfirmarModificacion').addEventListener('click', () => {
      modalAdvertencia.classList.remove('active');
      enModoEdicion = true;
      setFormDisabled(false);
      document.getElementById('btnGroupView').style.display = 'none';
      document.getElementById('btnGroupEdit').style.display = 'flex';
      document.getElementById('modeBadge').textContent = 'Modo Edici√≥n';
      document.getElementById('modeBadge').className = 'mode-badge edit';
      showAlert('Modo edici√≥n activado. Realice los cambios necesarios', 'info');
      document.getElementById('apellidoPaterno').focus();
    });

    document.getElementById('btnCancelarModificacion').addEventListener('click', () => {
      modalAdvertencia.classList.remove('active');
    });

    document.getElementById('btnCerrarAdvertencia').addEventListener('click', () => {
      modalAdvertencia.classList.remove('active');
    });

    document.getElementById('btnCancelarEdicion').addEventListener('click', () => {
      if (esNuevoSocio) {
        resetToSearch();
      } else {
        enModoEdicion = false;
        fillForm(datosOriginales);
        setFormDisabled(true);
        document.getElementById('btnGroupView').style.display = 'flex';
        document.getElementById('btnGroupEdit').style.display = 'none';
        document.getElementById('modeBadge').textContent = 'Modo Lectura';
        document.getElementById('modeBadge').className = 'mode-badge read';
        limpiarIndicadoresCambios();
        showAlert('Edici√≥n cancelada. Se restauraron los datos originales', 'info');
      }
    });

    formEdicion.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const socio = {
        dni: document.getElementById('dniEdit').value.trim(),
        apellidoPaterno: document.getElementById('apellidoPaterno').value.trim(),
        apellidoMaterno: document.getElementById('apellidoMaterno').value.trim(),
        nombres: document.getElementById('nombres').value.trim(),
        telefono1: document.getElementById('telefono1').value.trim(),
        telefono2: document.getElementById('telefono2').value.trim(),
        direccion: document.getElementById('direccion').value.trim(),
        conyuge: document.getElementById('conyuge').value.trim(),
        etapa: document.getElementById('etapa').value.trim(),
        email: document.getElementById('email').value.trim(),
        pagoCuota: document.getElementById('pagoCuota').value,
        placa1: document.getElementById('placa1').value.trim(),
        placa2: document.getElementById('placa2').value.trim(),
        placa3: document.getElementById('placa3').value.trim(),
        puntuacion: document.getElementById('puntuacion').value.trim()
      };

      if (!socio.dni || !/^\d{8}$/.test(socio.dni)) {
        showAlert('DNI inv√°lido', 'error');
        return;
      }

      showLoading(true);

      try {
        const formData = new URLSearchParams();
        formData.append('action', 'actualizar');
        for (const key in socio) {
          formData.append(key, socio[key]);
        }

        const resp = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        const data = await resp.json();
        
        if (data.success) {
          socioActual = socio;
          datosOriginales = JSON.parse(JSON.stringify(socio));
          enModoEdicion = false;
          
          if (esNuevoSocio) {
            esNuevoSocio = false;
            modalBienvenida.classList.add('active');
          } else {
            modalActualizacion.classList.add('active');
          }
        } else {
          showAlert(data.message, 'error');
        }
      } catch (error) {
        showAlert('Error al guardar: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    });

    document.getElementById('btnCerrarModalBienvenida').addEventListener('click', () => {
      modalBienvenida.classList.remove('active');
      resetToSearch();
      showAlert('¬°Registro completado! Puede realizar una nueva consulta', 'success');
    });

    document.getElementById('btnCerrarBienvenida').addEventListener('click', () => {
      modalBienvenida.classList.remove('active');
      resetToSearch();
      showAlert('¬°Bienvenido a Valle Real! Puede realizar una nueva consulta', 'success');
    });

    document.getElementById('btnNuevaConsulta').addEventListener('click', () => {
      modalBienvenida.classList.remove('active');
      resetToSearch();
      document.getElementById('dni').focus();
    });

    document.getElementById('btnCerrarModalActualizar').addEventListener('click', () => {
      modalActualizacion.classList.remove('active');
      setFormDisabled(true);
      document.getElementById('btnGroupView').style.display = 'flex';
      document.getElementById('btnGroupEdit').style.display = 'none';
      document.getElementById('modeBadge').textContent = 'Modo Lectura';
      document.getElementById('modeBadge').className = 'mode-badge read';
      limpiarIndicadoresCambios();
      showAlert('Sus datos han sido actualizados correctamente', 'success');
    });

    document.getElementById('btnCerrarActualizacion').addEventListener('click', () => {
      modalActualizacion.classList.remove('active');
      setFormDisabled(true);
      document.getElementById('btnGroupView').style.display = 'flex';
      document.getElementById('btnGroupEdit').style.display = 'none';
      document.getElementById('modeBadge').textContent = 'Modo Lectura';
      document.getElementById('modeBadge').className = 'mode-badge read';
      limpiarIndicadoresCambios();
      showAlert('Sus datos han sido actualizados correctamente', 'success');
    });

    document.getElementById('btnCancelar').addEventListener('click', () => {
      resetToSearch();
    });

    document.getElementById('btnDescargarPDF').addEventListener('click', () => {
      if (!socioActual || !socioActual.dni) {
        showAlert('No hay datos del socio para generar reporte', 'error');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFillColor(220, 38, 38);
      doc.rect(0, 0, 210, 45, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(24);
      doc.setFont(undefined, 'bold');
      doc.text('REPORTE DE SOCIO', 105, 20, { align: 'center' });
      doc.setFontSize(16);
      doc.text('Urbanizaci√≥n Valle Real', 105, 32, { align: 'center' });

      doc.setTextColor(0, 0, 0);
      doc.setFontSize(12);
      let y = 60;
      const leftMargin = 20;

      const agregarCampo = (label, value) => {
        if (value) {
          doc.setFont(undefined, 'bold');
          doc.setTextColor(220, 38, 38);
          doc.text(label, leftMargin, y);
          doc.setFont(undefined, 'normal');
          doc.setTextColor(0, 0, 0);
          doc.text(value.toString(), leftMargin + 50, y);
          y += 10;
        }
      };

      agregarCampo('DNI:', socioActual.dni);
      agregarCampo('Apellidos:', `${socioActual.apellidoPaterno || ''} ${socioActual.apellidoMaterno || ''}`);
      agregarCampo('Nombres:', socioActual.nombres);
      agregarCampo('Tel√©fono 1:', socioActual.telefono1);
      agregarCampo('Tel√©fono 2:', socioActual.telefono2);
      agregarCampo('Direcci√≥n:', socioActual.direccion);
      agregarCampo('Etapa:', socioActual.etapa);
      agregarCampo('C√≥nyuge:', socioActual.conyuge);
      agregarCampo('Email:', socioActual.email);
      agregarCampo('Pago Cuota:', socioActual.pagoCuota);
      agregarCampo('Placa 1:', socioActual.placa1);
      agregarCampo('Placa 2:', socioActual.placa2);
      agregarCampo('Placa 3:', socioActual.placa3);
      agregarCampo('Puntuaci√≥n:', socioActual.puntuacion);

      doc.setFontSize(10);
      doc.setTextColor(128, 128, 128);
      const fecha = new Date().toLocaleDateString('es-PE', { year: 'numeric', month: 'long', day: 'numeric' });
      doc.text(`Generado el ${fecha}`, 105, 280, { align: 'center' });

      doc.save(`Socio_${socioActual.dni}_${Date.now()}.pdf`);
      showAlert('PDF descargado correctamente', 'success');
    });

    document.getElementById('formLoginAdmin').addEventListener('submit', async (e) => {
      e.preventDefault();
      const dni = document.getElementById('adminDni').value.trim();
      const pass = document.getElementById('adminPass').value;

      if (!/^\d{8}$/.test(dni)) {
        showAlert('DNI inv√°lido', 'error');
        return;
      }

      showLoading(true);

      try {
        const formData = new URLSearchParams();
        formData.append('action', 'loginAdmin');
        formData.append('dni', dni);
        formData.append('pass', pass);

        const resp = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        const data = await resp.json();

        if (data.success) {
          showAlert('Login exitoso. Bienvenido Administrador', 'success');
          document.getElementById('loginAdmin').classList.add('hidden');
          document.getElementById('panelAdmin').classList.remove('hidden');
          consultaSection.classList.add('hidden');
          cargarDatosAdmin();
        } else {
          showAlert(data.message, 'error');
        }
      } catch (error) {
        showAlert('Error en login: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    });

    async function cargarDatosAdmin() {
      showLoading(true);
      try {
        const resp = await fetch(`${APPS_SCRIPT_URL}?action=obtenerTodos`);
        const data = await resp.json();
        
        if (data.success) {
          todosSocios = data.socios;
          actualizarEstadisticas();
          mostrarResultadosBusqueda(todosSocios);
          crearGrafico();
        } else {
          showAlert('Error al cargar datos', 'error');
        }
      } catch (error) {
        showAlert('Error al cargar datos: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }

    function actualizarEstadisticas() {
      const total = todosSocios.length;
      const conTel = todosSocios.filter(s => s.telefono1).length;
      const sinTel = total - conTel;
      const conCony = todosSocios.filter(s => s.conyuge).length;

      document.getElementById('totalSocios').textContent = total;
      document.getElementById('conDatos').textContent = conTel;
      document.getElementById('sinDatos').textContent = sinTel;
      document.getElementById('conConyuge').textContent = conCony;
    }

    function crearGrafico() {
      const ctx = document.getElementById('chartSocios');
      
      if (chartInstance) {
        chartInstance.destroy();
      }

      const conTel = todosSocios.filter(s => s.telefono1).length;
      const sinTel = todosSocios.length - conTel;
      const conCony = todosSocios.filter(s => s.conyuge).length;
      const sinCony = todosSocios.length - conCony;
      const pagaSi = todosSocios.filter(s => s.pagoCuota === 'S√≠').length;
      const pagaNo = todosSocios.filter(s => s.pagoCuota === 'No').length;

      chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Con Tel√©fono', 'Sin Tel√©fono', 'Con C√≥nyuge', 'Sin C√≥nyuge', 'Paga Cuota', 'No Paga'],
          datasets: [{
            label: 'Cantidad de Socios',
            data: [conTel, sinTel, conCony, sinCony, pagaSi, pagaNo],
            backgroundColor: [
              'rgba(220, 38, 38, 0.8)',
              'rgba(153, 27, 27, 0.8)',
              'rgba(17, 153, 142, 0.8)',
              'rgba(56, 239, 125, 0.8)',
              'rgba(245, 158, 11, 0.8)',
              'rgba(239, 68, 68, 0.8)'
            ],
            borderColor: [
              'rgba(220, 38, 38, 1)',
              'rgba(153, 27, 27, 1)',
              'rgba(17, 153, 142, 1)',
              'rgba(56, 239, 125, 1)',
              'rgba(245, 158, 11, 1)',
              'rgba(239, 68, 68, 1)'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 }
            }
          }
        }
      });
    }

    document.getElementById('formBusquedaAvanzada').addEventListener('submit', (e) => {
      e.preventDefault();
      realizarBusqueda();
    });

    document.getElementById('btnMostrarTodos').addEventListener('click', () => {
      document.getElementById('busqDni').value = '';
      document.getElementById('busqNombre').value = '';
      document.getElementById('busqTel').value = '';
      document.getElementById('busqDir').value = '';
      document.getElementById('busqEtapa').value = '';
      document.getElementById('busqEmail').value = '';
      mostrarResultadosBusqueda(todosSocios);
    });

    function realizarBusqueda() {
      const dni = document.getElementById('busqDni').value.toLowerCase();
      const nombre = document.getElementById('busqNombre').value.toLowerCase();
      const tel = document.getElementById('busqTel').value;
      const dir = document.getElementById('busqDir').value.toLowerCase();
      const etapa = document.getElementById('busqEtapa').value.toLowerCase();
      const email = document.getElementById('busqEmail').value.toLowerCase();

      let resultados = todosSocios;

      if (dni) resultados = resultados.filter(s => s.dni && s.dni.includes(dni));
      if (nombre) resultados = resultados.filter(s => (`${s.nombres || ''} ${s.apellidoPaterno || ''} ${s.apellidoMaterno || ''}`).toLowerCase().includes(nombre));
      if (tel) resultados = resultados.filter(s => (s.telefono1 && s.telefono1.includes(tel)) || (s.telefono2 && s.telefono2.includes(tel)));
      if (dir) resultados = resultados.filter(s => s.direccion && s.direccion.toLowerCase().includes(dir));
      if (etapa) resultados = resultados.filter(s => s.etapa && s.etapa.toLowerCase().includes(etapa));
      if (email) resultados = resultados.filter(s => s.email && s.email.toLowerCase().includes(email));

      mostrarResultadosBusqueda(resultados);
    }

    function mostrarResultadosBusqueda(resultados) {
      const contenedor = document.getElementById('resultadosBusqueda');
      
      if (resultados.length === 0) {
        contenedor.innerHTML = '<p style="text-align: center; color: #666; padding: 30px; font-size: 1.1em;"><i class="fas fa-search" style="font-size: 3em; display: block; margin-bottom: 15px; color: #dc2626;"></i>No se encontraron resultados</p>';
        return;
      }

      let html = `<div style="background: #dc2626; color: white; padding: 15px; border-radius: 10px; margin-top: 25px; display: flex; align-items: center; gap: 10px; font-weight: 600;"><i class="fas fa-list-ul"></i> <span>Resultados: ${resultados.length} socio(s)</span></div>`;
      
      html += `<div style="overflow-x: auto; margin-top: 15px;"><table><thead><tr><th>DNI</th><th>Nombre Completo</th><th>Tel√©fono 1</th><th>Tel√©fono 2</th><th>Direcci√≥n</th><th>Etapa</th><th>C√≥nyuge</th></tr></thead><tbody>`;

      resultados.forEach(s => {
        html += `<tr><td><strong>${s.dni || ''}</strong></td><td>${s.apellidoPaterno || ''} ${s.apellidoMaterno || ''}, ${s.nombres || ''}</td><td>${s.telefono1 || '-'}</td><td>${s.telefono2 || '-'}</td><td>${s.direccion || '-'}</td><td>${s.etapa || '-'}</td><td>${s.conyuge || '-'}</td></tr>`;
      });

      html += '</tbody></table></div>';
      contenedor.innerHTML = html;
    }

    document.getElementById('btnReportePDF').addEventListener('click', () => {
      if (todosSocios.length === 0) {
        showAlert('No hay datos para generar reporte', 'error');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('landscape');

      doc.setFillColor(220, 38, 38);
      doc.rect(0, 0, 297, 40, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(22);
      doc.setFont(undefined, 'bold');
      doc.text('LISTA DE SOCIOS - VALLE REAL', 148.5, 18, { align: 'center' });
      doc.setFontSize(14);
      doc.text(`Total: ${todosSocios.length} socios registrados`, 148.5, 30, { align: 'center' });

      const tableData = todosSocios.map(s => [s.dni || '', `${s.apellidoPaterno || ''} ${s.apellidoMaterno || ''}`, s.nombres || '', s.telefono1 || '-', s.direccion || '-', s.etapa || '-', s.pagoCuota || '-']);

      doc.autoTable({
        startY: 45,
        head: [['DNI', 'Apellidos', 'Nombres', 'Tel√©fono', 'Direcci√≥n', 'Etapa', 'Pago']],
        body: tableData,
        theme: 'grid',
        headStyles: { fillColor: [220, 38, 38], fontSize: 10, fontStyle: 'bold', halign: 'center' },
        bodyStyles: { fontSize: 9 },
        alternateRowStyles: { fillColor: [245, 245, 245] }
      });

      doc.save(`Lista_Socios_Valle_Real_${Date.now()}.pdf`);
      showAlert('PDF descargado correctamente', 'success');
    });

    document.getElementById('btnReporteExcel').addEventListener('click', () => {
      if (todosSocios.length === 0) {
        showAlert('No hay datos para generar reporte', 'error');
        return;
      }

      const excelData = todosSocios.map(s => ({ 'DNI': s.dni || '', 'Apellido Paterno': s.apellidoPaterno || '', 'Apellido Materno': s.apellidoMaterno || '', 'Nombres': s.nombres || '', 'Tel√©fono 1': s.telefono1 || '', 'Tel√©fono 2': s.telefono2 || '', 'Direcci√≥n': s.direccion || '', 'Etapa': s.etapa || '', 'C√≥nyuge': s.conyuge || '', 'Email': s.email || '', 'Pago Cuota': s.pagoCuota || '', 'Placa 1': s.placa1 || '', 'Placa 2': s.placa2 || '', 'Placa 3': s.placa3 || '', 'Puntuaci√≥n': s.puntuacion || '' }));

      const ws = XLSX.utils.json_to_sheet(excelData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Socios Valle Real');

      XLSX.writeFile(wb, `Lista_Socios_Valle_Real_${Date.now()}.xlsx`);
      showAlert('Excel descargado correctamente', 'success');
    });

    document.getElementById('btnDescargarGrafico').addEventListener('click', () => {
      if (!chartInstance) {
        showAlert('No hay gr√°fico para descargar', 'error');
        return;
      }

      const canvas = document.getElementById('chartSocios');
      const url = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.download = `Grafico_Estadisticas_Valle_Real_${Date.now()}.png`;
      link.href = url;
      link.click();
      showAlert('Gr√°fico descargado correctamente', 'success');
    });

    document.getElementById('btnCerrarSesion').addEventListener('click', () => {
      document.getElementById('panelAdmin').classList.add('hidden');
      document.getElementById('loginAdmin').classList.remove('hidden');
      consultaSection.classList.remove('hidden');
      todosSocios = [];
      document.getElementById('resultadosBusqueda').innerHTML = '';
      document.getElementById('formLoginAdmin').reset();
      if (chartInstance) {
        chartInstance.destroy();
        chartInstance = null;
      }
      showAlert('Sesi√≥n cerrada exitosamente', 'success');
    });

    const camposEditables = ['apellidoPaterno', 'apellidoMaterno', 'nombres', 'telefono1', 'telefono2', 'direccion', 'conyuge', 'etapa', 'email', 'pagoCuota', 'placa1', 'placa2', 'placa3', 'puntuacion'];

    camposEditables.forEach(campoId => {
      const input = document.getElementById(campoId);
      input.addEventListener('change', () => detectarCambio(campoId));
      input.addEventListener('input', () => detectarCambio(campoId));
    });

    function detectarCambio(campoId) {
      const input = document.getElementById(campoId);
      const valorActual = input.value.trim();
      const valorOriginal = (datosOriginales[campoId] || '').trim();
      const formGroup = input.closest('.form-group');
      const indicator = formGroup.querySelector('.change-indicator');

      if (valorActual !== valorOriginal) {
        if (valorActual === '') {
          formGroup.classList.add('cleared');
          formGroup.classList.remove('modified');
          indicator.textContent = 'üóëÔ∏è Campo borrado';
          indicator.className = 'change-indicator cleared';
        } else {
          formGroup.classList.add('modified');
          formGroup.classList.remove('cleared');
          indicator.textContent = '‚úèÔ∏è Modificado';
          indicator.className = 'change-indicator modified';
        }
      } else {
        formGroup.classList.remove('modified', 'cleared');
        indicator.className = 'change-indicator';
        indicator.textContent = '';
      }
    }

    function limpiarIndicadoresCambios() {
      camposEditables.forEach(campoId => {
        const formGroup = document.getElementById(campoId).closest('.form-group');
        formGroup.classList.remove('modified', 'cleared');
        const indicator = formGroup.querySelector('.change-indicator');
        indicator.className = 'change-indicator';
        indicator.textContent = '';
      });
    }

    document.querySelectorAll('.btn-clear').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const input = btn.closest('.form-group').querySelector('input, select');
        input.value = '';
        input.dispatchEvent(new Event('change', { bubbles: true }));
        input.focus();
      });

      const input = btn.closest('.form-group').querySelector('input, select');
      input.addEventListener('focus', () => {
        if (enModoEdicion) {
          btn.style.display = 'flex';
        }
      });
      input.addEventListener('blur', () => {
        btn.style.display = 'none';
      });
    });

    function fillForm(socio) {
      document.getElementById('dniEdit').value = socio.dni || '';
      document.getElementById('apellidoPaterno').value = socio.apellidoPaterno || '';
      document.getElementById('apellidoMaterno').value = socio.apellidoMaterno || '';
      document.getElementById('nombres').value = socio.nombres || '';
      document.getElementById('telefono1').value = socio.telefono1 || '';
      document.getElementById('telefono2').value = socio.telefono2 || '';
      document.getElementById('direccion').value = socio.direccion || '';
      document.getElementById('conyuge').value = socio.conyuge || '';
      document.getElementById('etapa').value = socio.etapa || '';
      document.getElementById('email').value = socio.email || '';
      document.getElementById('pagoCuota').value = socio.pagoCuota || '';
      document.getElementById('placa1').value = socio.placa1 || '';
      document.getElementById('placa2').value = socio.placa2 || '';
      document.getElementById('placa3').value = socio.placa3 || '';
      document.getElementById('puntuacion').value = socio.puntuacion || '';
    }

    function clearForm() {
      document.getElementById('apellidoPaterno').value = '';
      document.getElementById('apellidoMaterno').value = '';
      document.getElementById('nombres').value = '';
      document.getElementById('telefono1').value = '';
      document.getElementById('telefono2').value = '';
      document.getElementById('direccion').value = '';
      document.getElementById('conyuge').value = '';
      document.getElementById('etapa').value = '';
      document.getElementById('email').value = '';
      document.getElementById('pagoCuota').value = '';
      document.getElementById('placa1').value = '';
      document.getElementById('placa2').value = '';
      document.getElementById('placa3').value = '';
      document.getElementById('puntuacion').value = '';
    }

    function setFormDisabled(disabled) {
      camposEditables.forEach(campoId => {
        document.getElementById(campoId).disabled = disabled;
      });
    }
  </script>
</body>
</html>
